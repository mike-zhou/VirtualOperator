@startuml

participant app
participant stepper
participant timer
participant encoder

note over app, stepper: initialize steppers
app -> stepper: stepper_init_data_structure
loop each stepper
    app -> stepper: stepper_set_controls

    loop
        app -> stepper: stepper_set_master_cruise_pulse_width
    end
    app -> stepper: stepper_set_master_cruise_pulse_width
    loop
        app -> stepper: stepper_set_master_rampdown_pulse_widths
    end
end


note over app, timer: initialize timers
app -> timer: timer_init_data_structure

note across: stepper home positioning
loop
    app -> stepper: stepper_set_enable

    app -> stepper: stepper_start_home_positioning
    app -> stepper: stepper_get_current_pulse_width
    app -> timer: timer_start

    loop
        timer -> stepper: on_stepper_pulse_end
        alt HOME
            stepper -> encoder: get_encoder
        end
    end

    app -> stepper: stepper_get_state
end

@enduml
